# 内网访问配置指南

本指南将帮助您配置系统，使其可以在内网中的其他计算机上访问。

## 快速配置步骤

### 1. 获取本机 IP 地址

**Windows PowerShell:**
```powershell
ipconfig | findstr IPv4
```

**Windows CMD:**
```cmd
ipconfig
```
查找 "IPv4 地址"，例如：`192.168.1.100`

**Linux/Mac:**
```bash
ifconfig | grep "inet "
# 或
hostname -I
```

### 2. 配置前端环境变量

在 `frontend` 目录下创建或编辑 `.env` 文件：

```env
# 将 <your-ip> 替换为你的实际 IP 地址
VITE_API_BASE_URL=http://<your-ip>:3000/api/v1
```

**示例：**
如果您的 IP 地址是 `192.168.1.100`，则配置为：
```env
VITE_API_BASE_URL=http://192.168.1.100:3000/api/v1
```

### 3. 配置防火墙（Windows）

允许端口通过防火墙：

**方法一：使用 PowerShell（管理员权限）**
```powershell
# 允许前端端口 5173
New-NetFirewallRule -DisplayName "Vite Dev Server" -Direction Inbound -LocalPort 5173 -Protocol TCP -Action Allow

# 允许后端端口 3000
New-NetFirewallRule -DisplayName "Backend API Server" -Direction Inbound -LocalPort 3000 -Protocol TCP -Action Allow
```

**方法二：使用图形界面**
1. 打开 "Windows Defender 防火墙"
2. 点击 "高级设置"
3. 选择 "入站规则" → "新建规则"
4. 选择 "端口" → 下一步
5. 选择 "TCP"，输入端口号 `5173` 和 `3000`（分别创建两条规则）
6. 选择 "允许连接"
7. 应用到所有配置文件
8. 命名规则并完成

### 4. 启动服务

**终端 1 - 启动后端服务：**
```bash
cd backend
npm run dev
```

**终端 2 - 启动前端服务：**
```bash
cd frontend
npm run dev
```

### 5. 访问应用

在**其他内网计算机**的浏览器中访问：
```
http://<your-ip>:5173
```

**示例：**
```
http://192.168.1.100:5173
```

## 验证配置

### 检查服务是否正常启动

启动后，您应该看到类似以下输出：

**后端：**
```
🚀 Server is running on http://0.0.0.0:3000
🌐 Access from network: http://<your-ip>:3000
```

**前端：**
```
  VITE v5.x.x  ready in xxx ms

  ➜  Local:   http://localhost:5173/
  ➜  Network: http://<your-ip>:5173/
```

### 测试连接

1. 在同一台计算机上访问 `http://localhost:5173`，确认服务正常
2. 在其他计算机上访问 `http://<your-ip>:5173`，确认可以访问

## 常见问题

### 问题 1：无法访问，显示 "无法连接"

**解决方案：**
- 检查防火墙是否允许端口 5173 和 3000
- 确认 IP 地址是否正确
- 确认所有设备在同一局域网内
- 检查后端服务是否正常启动

### 问题 2：前端可以访问，但 API 请求失败

**解决方案：**
- 检查 `.env` 文件中的 `VITE_API_BASE_URL` 是否配置正确
- 确认后端服务正在运行
- 检查后端端口 3000 是否被防火墙阻止
- 重启前端服务（修改 `.env` 后需要重启）

### 问题 3：IP 地址经常变化

**解决方案：**
- 在路由器中为您的计算机设置静态 IP（推荐）
- 或使用计算机名称代替 IP（需要配置 DNS 或 hosts 文件）

### 问题 4：端口被占用

**解决方案：**
- 修改 `frontend/vite.config.ts` 中的 `port` 配置
- 修改后端环境变量 `PORT`（默认 3000）
- 同时更新 `.env` 文件中的端口号

## 生产环境部署

如果需要在生产环境中部署，建议：

1. **构建前端：**
   ```bash
   cd frontend
   npm run build
   ```

2. **使用 Nginx 或其他 Web 服务器**提供静态文件服务

3. **配置反向代理**，将 API 请求转发到后端服务

4. **使用 HTTPS** 保护数据传输

## 安全提示

⚠️ **重要：** 当前配置仅适用于内网环境。如果需要在公网访问，请务必：
- 配置 HTTPS
- 添加身份验证
- 配置防火墙规则
- 定期更新依赖包

